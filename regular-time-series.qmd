---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Regular time series

If a time series is "regular", that is it has equal time steps between observations, and no missing observations, then its power spectrum can be estimated from its Fourier transform. 


## The Fourier Transform

```{r}
sunspot <- datasets::sunspot.month
plot(sunspot)
```

```{r}
library(PaleoSpec)
sp_sun <- SpecMTM(sunspot)
LPlot(sp_sun)
```


## The Multitaper Method



## To detrend or not {#sec-detrend}

- Even with detrend = FALSE, SpecMTM does some detrending - must be part of the tapering?


```{r}
library(dplyr)
library(tidyr)
library(PaleoSpec)
library(ggplot2)


N <- 1e03
n_rep <- 1000
alpha = 0.1
beta = 0

dat <- crossing(
  rep = 1:n_rep,
  t = 1:N
) #%>% 
  # group_by(rep) %>% 
  # mutate(
  #   y = PaleoSpec::SimPLS(N = N, beta = beta, alpha = alpha) 
  # )

# Get a matrix of simulated timeseries
ts_m <- replicate(n_rep, PaleoSpec::SimPLS(N = N, beta = beta, alpha = alpha))

mean_spec <- SpecACF(ts_m, bin.width = 1, detrend = FALSE)
mean_spec_detrended <- SpecACF(ts_m, bin.width = 1)

dat$y <- as.numeric(ts_m)

specs_mtm_detrend <- dat %>% 
  group_by(rep) %>% 
  do({
    Spec2DF(SpecMTM(ts(.$y), 
                    detrend = TRUE
                    )
            )
  })

specs_mtm_raw <- dat %>% 
  group_by(rep) %>% 
  do({
    Spec2DF(SpecMTM(ts(.$y), 
                    detrend = FALSE
                    )
            )
  })


mean_spec_MTM_raw <- specs_mtm_raw %>% 
  group_by(freq) %>% 
  summarise_if(is.numeric, mean)

mean_spec_MTM_detrended <- specs_mtm_detrend %>% 
  group_by(freq) %>% 
  summarise_if(is.numeric, mean)

gg_spec(list("Periodogram_raw_ts" = mean_spec,
             "Periodogram_detrended_ts" = mean_spec_detrended,
             MTM_detrended = mean_spec_MTM_detrended,
             MTM_raw_ts = mean_spec_MTM_raw)) #+
  #geom_point(aes(x = freq, y = spec, colour = spec_id))
```




## Errors

- Explain Gamma / Chi-Sq nature of the errors
- Degrees of freedom / shape of Gamma
- Effect of tapering and smoothing on error distribution
- Confidence intervals

